!function(){"use strict";function e(e){var t=e;return{get:function(){return t},set:function(e){t=e}}}function t(e){return e.getParam("spellchecker_rpc_url")}function n(e){var t=new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\xa7\xa9\xab\xae\xb1\xb6\xb7\xb8\xbb\xbc\xbd\xbe\xbf\xd7\xf7\xa4\u201d\u201c\u201e\xa0\u2002\u2003\u2009]+',"g");return e.getParam("spellchecker_wordchar_pattern",t)}function r(e){return e&&1===e.nodeType&&"false"===e.contentEditable}function o(e,t){function n(t){var n=e.getElementsByTagName("*"),r=[];t="number"==typeof t?""+t:null;for(var o=0;o<n.length;o++){var a=n[o],i=a.getAttribute("data-mce-index");null!==i&&i.length&&-1!==a.className.indexOf("mce-spellchecker-word")&&(i!==t&&null!==t||r.push(a))}return r}function o(e){for(var t=l.length;t--;)if(l[t]===e)return t;return-1}function a(e){for(var t=0,n=l.length;t<n&&!1!==e(l[t],t);t++);return this}function i(e){for(var t=n(e?o(e):null),r=t.length;r--;)!function(e){for(var t=e.parentNode;0<e.childNodes.length;)t.insertBefore(e.childNodes[0],e);t.removeChild(e)}(t[r]);return this}function c(e){var r=n(o(e)),a=t.dom.createRng();return a.setStartBefore(r[0]),a.setEndAfter(r[r.length-1]),a}var s,l=[],u=t.dom,d=t.schema.getBlockElements(),f=t.schema.getWhiteSpaceElements(),h=t.schema.getShortEndedElements(),g=function(e){if(3===e.nodeType)return e.data;if(f[e.nodeName]&&!d[e.nodeName])return"";if(r(e))return"\n";var t="";if((d[e.nodeName]||h[e.nodeName])&&(t+="\n"),e=e.firstChild)for(;t+=g(e),e=e.nextSibling;);return t},p=g(e);return{text:p,matches:l,each:a,filter:function(e){var t=[];return a((function(n,r){e(n,r)&&t.push(n)})),l=t,this},reset:function(){return l.splice(0,l.length),i(),this},matchFromElement:function(e){return l[e.getAttribute("data-mce-index")]},elementFromMatch:function(e){return n(o(e))[0]},find:function(e,t){if(p&&e.global)for(;s=e.exec(p);)l.push(function(e,t){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}}(s,t));return this},add:function(e,t,n){return l.push({start:e,end:e+t,text:p.substr(e,t),data:n}),this},wrap:function(t){function n(e,t){var n=l[t];n.stencil||(n.stencil=o(n));var r=n.stencil.cloneNode(!1);return r.setAttribute("data-mce-index",""+t),e&&r.appendChild(u.doc.createTextNode(e)),r}return l.length&&function(e,t,n){var o,a,i,c,s,l=[],u=0,g=e,p=0;(t=t.slice(0)).sort((function(e,t){return e.start-t.start})),s=t.shift();e:for(;;){if((d[g.nodeName]||h[g.nodeName]||r(g))&&u++,3===g.nodeType&&(!a&&g.length+u>=s.end?(a=g,c=s.end-u):o&&l.push(g),!o&&g.length+u>s.start&&(o=g,i=s.start-u),u+=g.length),o&&a){if(g=n({startNode:o,startNodeIndex:i,endNode:a,endNodeIndex:c,innerNodes:l,match:s.text,matchIndex:p}),u-=a.length-c,a=o=null,l=[],p++,!(s=t.shift()))break}else if(f[g.nodeName]&&!d[g.nodeName]||!g.firstChild){if(g.nextSibling){g=g.nextSibling;continue}}else if(!r(g)){g=g.firstChild;continue}for(;;){if(g.nextSibling){g=g.nextSibling;break}if(g.parentNode===e)break e;g=g.parentNode}}}(e,l,(o=t,function(e){var t=e.startNode,r=e.endNode,o=e.matchIndex,a=u.doc;if(t===r){var i=t,c=i.parentNode;0<e.startNodeIndex&&(l=a.createTextNode(i.data.substring(0,e.startNodeIndex)),c.insertBefore(l,i));var s=n(e.match,o);return c.insertBefore(s,i),e.endNodeIndex<i.length&&(d=a.createTextNode(i.data.substring(e.endNodeIndex)),c.insertBefore(d,i)),i.parentNode.removeChild(i),s}for(var l=a.createTextNode(t.data.substring(0,e.startNodeIndex)),d=a.createTextNode(r.data.substring(e.endNodeIndex)),f=n(t.data.substring(e.startNodeIndex),o),h=0,g=e.innerNodes.length;h<g;++h){var p=e.innerNodes[h],m=n(p.data,o);p.parentNode.replaceChild(m,p)}var v=n(r.data.substring(0,e.endNodeIndex),o);return(c=t.parentNode).insertBefore(l,t),c.insertBefore(f,t),c.removeChild(t),(c=r.parentNode).insertBefore(v,r),c.insertBefore(d,r),c.removeChild(r),v})),this;var o},unwrap:i,replace:function(e,n){var r=c(e);return r.deleteContents(),0<n.length&&r.insertNode(t.dom.doc.createTextNode(n)),r},rangeFromMatch:c,indexOf:o}}function a(e,t){var n;return t.get()||(n=o(e.getBody(),e),t.set(n)),t.get()}function i(e,n,r,o,a,i,c){var s,l,u;(e.getParam("spellchecker_callback")||(s=e,l=n,u=r,function(e,n,r,o){var a={method:e,lang:u.get()},i="";a["addToDictionary"===e?"word":"text"]=n,g.each(a,(function(e,t){i&&(i+="&"),i+=t+"="+encodeURIComponent(e)})),m.send({url:new p(l).toAbsolute(t(s)),type:"post",content_type:"application/x-www-form-urlencoded",data:i,success:function(e){var t,n=JSON.parse(e);n?n.error?o(n.error):r(n):(t=s.translate("Server response wasn't proper JSON."),o(t))},error:function(){var e=s.translate("The spelling service was not found: (")+t(s)+s.translate(")");o(e)}})})).call(e.plugins.spellchecker,o,a,i,c)}function c(e,t,n,r,o,c){v(e,n,r)||(e.setProgressState(!0),i(e,t,c,"spellcheck",a(e,r).text,(function(t){x(e,n,r,o,t)}),(function(t){e.notificationManager.open({text:t,type:"error"}),e.setProgressState(!1),v(e,n,r)})),e.focus())}function s(e,t,n){e.dom.select("span.mce-spellchecker-word").length||v(e,t,n)}function l(e,t,n,r,o,a){e.selection.collapse(),a?g.each(e.dom.select("span.mce-spellchecker-word"),(function(t){t.getAttribute("data-mce-word")===r&&e.dom.remove(t,!0)})):e.dom.remove(o,!0),s(e,t,n)}function u(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function d(e,t,n,r,o,a){e.ui.registry.addContextMenu("spellchecker",{update:function(c){var d=c;if("mce-spellchecker-word"!==d.className)return[];var f,h,p,m,v,x,N,k,y,S,b=function(e,t){var n=[],r=g.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(var o=0;o<r.length;o++){var a=u(r[o]);null!==a&&a.length&&a===t.toString()&&n.push(r[o])}return n}(e,u(d));if(0<b.length){var w=e.dom.createRng();return w.setStartBefore(b[0]),w.setEndAfter(b[b.length-1]),e.selection.setRng(w),f=e,h=t,p=n,m=r,v=o,x=a,N=d.getAttribute("data-mce-word"),k=b,y=[],S=p.get().suggestions[N],g.each(S,(function(e){y.push({text:e,onAction:function(){f.insertContent(f.dom.encode(e)),f.dom.remove(k),s(f,m,v)}})})),p.get().hasDictionarySupport&&(y.push({type:"separator"}),y.push({text:"Add to dictionary",onAction:function(){var e,t=h,n=m,r=v,o=x,a=N,c=k;(e=f).setProgressState(!0),i(e,t,o,"addToDictionary",a,(function(){e.setProgressState(!1),e.dom.remove(c,!0),s(e,n,r)}),(function(t){e.notificationManager.open({text:t,type:"error"}),e.setProgressState(!1)}))}})),y.push.apply(y,[{type:"separator"},{text:"Ignore",onAction:function(){l(f,m,v,N,k)}},{text:"Ignore all",onAction:function(){l(f,m,v,N,k,!0)}}]),y}}})}var f=tinymce.util.Tools.resolve("tinymce.PluginManager"),h=Object.hasOwnProperty,g=tinymce.util.Tools.resolve("tinymce.util.Tools"),p=tinymce.util.Tools.resolve("tinymce.util.URI"),m=tinymce.util.Tools.resolve("tinymce.util.XHR"),v=function(e,t,n){var r=e.selection.getBookmark();if(a(e,n).reset(),e.selection.moveToBookmark(r),n.set(null),t.get())return t.set(!1),e.fire("SpellcheckEnd"),!0},x=function(e,t,r,o,i){var c=!!i.dictionary,s=i.words;if(e.setProgressState(!1),function(e){for(var t in e)if(h.call(e,t))return;return 1}(s)){var l=e.translate("No misspellings found.");return e.notificationManager.open({text:l,type:"info"}),void t.set(!1)}o.set({suggestions:s,hasDictionarySupport:c});var u=e.selection.getBookmark();a(e,r).find(n(e)).filter((function(e){return!!s[e.text]})).wrap((function(t){return e.dom.create("span",{class:"mce-spellchecker-word","aria-invalid":"spelling","data-mce-bogus":1,"data-mce-word":t.text})})),e.selection.moveToBookmark(u),t.set(!0),e.fire("SpellcheckStart")},N=function(){return(N=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},k="SpellcheckStart SpellcheckEnd";f.add("spellchecker",(function(t,r){function o(){c(u,f,h,p,v,m)}if(0==(!!t.hasPlugin("tinymcespellchecker",!0)&&(void 0!==window.console&&window.console.log&&window.console.log("Spell Checker Pro is incompatible with Spell Checker plugin! Remove 'spellchecker' from the 'plugins' option."),!0))){var a=e(!1),i=e((F=(D=t).getParam("language","en"),D.getParam("spellchecker_language",F))),s=e(null),l=e(null);return u=t,f=r,h=a,p=s,m=i,v=l,y=g.map(u.getParam("spellchecker_languages","English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),(function(e){var t=e.split("=");return{name:t[0],value:t[1]}})),S=[],g.each(y,(function(e){S.push({selectable:!0,text:e.name,data:e.value})})),b=S,T=N(N({},w={tooltip:"Spellcheck",onAction:o,icon:"spell-check",onSetup:function(e){function t(){e.setActive(h.get())}return u.on(k,t),function(){u.off(k,t)}}}),{type:"splitbutton",select:function(e){return e===m.get()},fetch:function(e){e(g.map(b,(function(e){return{type:"choiceitem",value:e.data,text:e.text}})))},onItemAction:function(e,t){m.set(t)}}),1<b.length?u.ui.registry.addSplitButton("spellchecker",T):u.ui.registry.addToggleButton("spellchecker",w),u.ui.registry.addToggleMenuItem("spellchecker",{text:"Spellcheck",icon:"spell-check",onSetup:function(e){function t(){e.setActive(h.get())}return e.setActive(h.get()),u.on(k,t),function(){u.off(k,t)}},onAction:o}),d(t,r,l,a,s,i),E=r,R=a,_=s,M=l,O=i,(C=t).addCommand("mceSpellCheck",(function(){c(C,E,R,_,M,O)})),A=t,B=a,P=l,{getTextMatcher:(I=s).get,getWordCharPattern:function(){return n(A)},markErrors:function(e){x(A,B,I,P,e)},getLanguage:i.get}}var u,f,h,p,m,v,y,S,b,w,T,A,B,P,I,C,E,R,_,M,O,D,F}))}();